# 毕业项目

## AI平台

因为目前公司体量不大目前采用的还是单体架构，因为整体业务流量还不是很大所以一直也没出现什么并发问题。

### 架构重构

![架构](https://cdn.jsdelivr.net/gh/wcvb13/picture/img/%E6%9E%B6%E6%9E%84.png)

#### 目录结构

```
├─api           \\ 存放对外api、error等
├─cmd           \\ main函数 wire
├─configs       \\ 配置文件 -todo-> 配置中心
├─internal      \\ 内部使用
│  ├─config     \\ 配置
│  ├─data       \\ 数据层
│  ├─biz      	\\ 业务逻辑层
│  ├─di     	\\ 添加依赖注入
│  └─service    \\ 处理外部接口
└─test          \\ 测试
```

所有api均使用proto定义，内部使用grpc + grpc gateway导出成服务

#### 中间件

**日志部分**

对于所有服务日志，目前虽然使用的是自己开发的日志库，但日志输出没有统一，重构可以重新对日志库进行修改，统一日志格式。架构中使用ELK进行日志收集，方便后续bug定位排查。

#### cache

各个服务使用自己的db与cache，采用cache aside模式，如果cache miss则发送消息至kafka，单独起一个job服务从kafka中消费进行批量数据回填

#### BFF

bff层进行数据聚合时，依赖多个下游服务或其他bff服务时可以使用errgroup，批量处理。

#### API管理

对CI工具进行修改，后续提交代码可以自动从对应项目的api目录中提取proto文件，然后解析转换为yapi格式数据，使用yapi统一管理

#### 错误处理

项目中对于错误处理现在其实还是比较乱的，虽然也使用wrap保存了堆栈信息，但存在多次打印错误信息，与多次wrap的情况，重构中错误处理应该只在产生错误处wrap，在最后的调用方进行错误处理。